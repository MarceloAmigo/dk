#!/bin/bash
#
#  dockerc
#
VERSION="v0.7 30/03/2020"


if [ ! -f ~/.config/dockerc/dockerc.conf ]; then
    while true; do
        echo ""
        read -rp "El archivo de configuración no está creado, ¿Quieres crearlo ahora? (s/n) " yn
        case "${yn}" in
            [Ss]* ) mkdir -p  ~/.config/dockerc/
		    echo -en "\n Escribe la ruta completa del directorio donde tienes o quieres guardar tus docker-dotfile \n\n\t Ejemplo: /home/usuario/dockerc: "
		    read RUTA ; echo "RUTA_DOCKER_DOTFILE='"$RUTA"'" > ~/.config/dockerc/dockerc.conf
		    echo -en "\n ¿Que editor de texto quieres utilizar? \n\n\t Ejemplo: vim: "
		    read EDITOR ; echo "EDITOR='"$EDITOR"'" >> ~/.config/dockerc/dockerc.conf
		    break;;
            [Nn]* ) exit;;
            * ) echo "Please answer y or n";;
        esac
    done
fi

source ~/.config/dockerc/dockerc.conf


if [ "$1" = "-h" ] || [ "$1" = "--help" ]  
then
echo "
Modo de empleo: dockerc [OPCIONES]

dockerc                 -> Menú para crear un contendor guardado
dockerc   n             -> Guarda un nuevo docker
dockerc   i             -> Imagenes
dockerc   c,    ls      -> Dockers que están corriendo y sus puertos
dockerc   c -a ,ls -a   -> Todos los Dockers disponibles
dockerc  -h, --help     -> Ayuda


dockerc "$VERSION"
 Copyright (C) 2020 Angel. uGeek
 ugeekpodcast@gmail.com"
exit
fi


if [ "$1" = "i" ]
then
echo "--------"
echo "IMAGENES"
echo "--------"
docker images --format 'table {{.CreatedSince}}\t{{.Repository}}:{{.Tag}}\t{{.Size}}'
exit
fi

if [ "$1" = "ls" ] && [ "$2" = "-a" ] ||  [ "$1" = "c" ] && [ "$2" = "-a" ] 
then    
echo "----------------------"
echo "CONTAINERS DISPONIBLES"
echo "----------------------"
docker ps -a --format 'table {{.Names}}' |  sed 's|NAMES||g' | sort | sed '/^ *#/d; /^ *$/d' 2>/dev/null
exit
fi

if [ "$1" = "ls" ] || [ "$1" = "c" ]  
then
echo "----------------------------------"
echo "CONTAINERS CORRIENDO Y SUS PUERTOS"    
echo "----------------------------------"
docker ps --format 'table {{.Names}}\t{{.Ports}}' |  sed 's|NAMES||g' |  sed 's|PORTS||g' | sort | sed '/^ *#/d; /^ *$/d' 2>/dev/null
exit
fi

if [ "$1" = "n" ] 
then

clear
echo ""
echo "Vamos a guardar un nuevo docker."
echo ""
echo ""
echo "---------------------------------------"
echo "Listado de grupo de dockers disponibles"
echo "---------------------------------------"
echo ""
ls -1F | grep '/$' | sed s'|/||'g
echo ""
echo ""
echo -n " ¿A que grupo pertenece?: "  ; read GRUPO
mkdir -p $RUTA_DOCKER_DOTFILE/$GRUPO/
clear
echo  " "
echo -n " ¿Cual es el nombre del docker que quieres crear?: "  ; read NOMBRE
$EDITOR $RUTA_DOCKER_DOTFILE/$GRUPO/$NOMBRE.docker
clear
echo "El docker $NOMBRE ha sido guardado con éxito!!!"
exit
fi


clear
echo ""
echo "---------------------------------------"
echo "Listado de grupo de dockers disponibles"
echo "---------------------------------------"
echo ""
ls -1F | grep '/$' | sed s'|/||'g
echo ""
echo ""
echo ""
echo -n "Selecciona el grupo de dockers deseado: " ; read GRUPO
echo " "

clear
echo ""
echo "-----------------------------------"
echo "Listado de contenedores disponibles"
echo "-----------------------------------"
echo ""
ls -1 $RUTA_DOCKER_DOTFILE/$GRUPO/*.docker | cut -d "." -f1 | sed s'|'$RUTA_DOCKER_DOTFILE/$GRUPO'/||'g

echo " "

echo -n "  Escribe el nombre del docker que deseas montar: " ; read DOCKER


$EDITOR $RUTA_DOCKER_DOTFILE/$GRUPO/$DOCKER.docker

clear
echo "Creando el Contenedor "$DOCKER"..."
echo " "
bash $RUTA_DOCKER_DOTFILE/$GRUPO/$DOCKER.docker
